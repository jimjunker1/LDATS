<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Comparison to Christensen et al. 2018 • LDATS</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Comparison to Christensen et al. 2018">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">LDATS</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/LDATS_codebase.html">Latent Dirichlet Allocation Time Series (LDATS)</a>
    </li>
    <li>
      <a href="../articles/paper-comparison.html">Comparison to Christensen et al. 2018</a>
    </li>
    <li>
      <a href="../articles/rodents-example.html">LDATS Rodents Example</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://twitter.com/weecology">
    <span class="fa fa-twitter"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/weecology/LDATS">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Comparison to Christensen et al. 2018</h1>
                        <h4 class="author">Renata Diaz</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/weecology/LDATS/blob/master/vignettes/paper-comparison.Rmd"><code>vignettes/paper-comparison.Rmd</code></a></small>
      <div class="hidden name"><code>paper-comparison.Rmd</code></div>

    </div>

    
    
<p>This document prodives a side-by-side comparison of LDATS (v0.1.0) results with analysis from <a href="https://esajournals.onlinelibrary.wiley.com/doi/full/10.1002/ecy.2373">Christensen et al. 2018</a>.</p>
<div id="summary" class="section level2">
<h2 class="hasAnchor">
<a href="#summary" class="anchor"></a>Summary</h2>
<table class="table">
<colgroup>
<col width="17%">
<col width="26%">
<col width="25%">
<col width="30%">
</colgroup>
<thead><tr class="header">
<th align="left">Step</th>
<th align="left">Changes from Christensen et al 2018 to <code>LDATS</code>
</th>
<th align="left">Effect on comparison</th>
<th align="left">Recommendations for future users</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Data</td>
<td align="left">Paper adjusts abundances according to unit effort, while <code>LDATS</code> uses raw capture numbers.</td>
<td align="left">None: run comparison using adjusted data</td>
<td align="left">Use raw, unweighted abundances.</td>
</tr>
<tr class="even">
<td align="left">LDA model selection</td>
<td align="left">Paper conservatively overestimated the number of parameters for calculating AIC for model selection. <code>LDATS</code> calculates AIC appropriately.</td>
<td align="left">Paper LDA selects 4 topics, while <code>LDATS</code> finds 6. Compare all combinations of paper and <code>LDATS</code> LDA models and changepoint models</td>
<td align="left">Use <code>LDATS</code> AIC calculation.</td>
</tr>
<tr class="odd">
<td align="left">Changepoint model document weights</td>
<td align="left">Paper weighted all sampling periods equally regardless of abundance. <code>LDATS</code> by default weights the information from each sampling period according to the number of individuals captured (i.e. the amount of information gleaned about the underlying community composition).</td>
<td align="left">None; use <code>weights = NULL</code> to set all weights equal to 1 for LDATS</td>
<td align="left">Weight sampling periods according to abundance</td>
</tr>
<tr class="even">
<td align="left">Overall LDA + changepoint results</td>
<td align="left">All combinations of LDA + changepoint model find 4 changepoints at approximately the same time steps</td>
<td align="left">Choice of LDA model has more of an effect than choice of changepoint model</td>
<td align="left">
<code>LDATS</code> reflects best practices, but the paper methods will produce qualitatively similar results.</td>
</tr>
</tbody>
</table>
</div>
<div id="ldats-installation" class="section level2">
<h2 class="hasAnchor">
<a href="#ldats-installation" class="anchor"></a>LDATS Installation</h2>
<p>To obtain the most recent version of <strong>LDATS</strong>, install the most recent version from GitHub:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/install.packages">install.packages</a></span>(<span class="st">"devtools"</span>)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2">devtools<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/devtools/topics/reexports">install_github</a></span>(<span class="st">"weecology/LDATS"</span>)</a></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(LDATS)</a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(dplyr)</a>
<a class="sourceLine" id="cb2-3" data-line-number="3"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="co">#&gt; Attaching package: 'dplyr'</span></a>
<a class="sourceLine" id="cb2-5" data-line-number="5"><span class="co">#&gt; The following objects are masked from 'package:stats':</span></a>
<a class="sourceLine" id="cb2-6" data-line-number="6"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb2-7" data-line-number="7"><span class="co">#&gt;     filter, lag</span></a>
<a class="sourceLine" id="cb2-8" data-line-number="8"><span class="co">#&gt; The following objects are masked from 'package:base':</span></a>
<a class="sourceLine" id="cb2-9" data-line-number="9"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb2-10" data-line-number="10"><span class="co">#&gt;     intersect, setdiff, setequal, union</span></a>
<a class="sourceLine" id="cb2-11" data-line-number="11"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/load">load</a></span>(here<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/here/topics/here">here</a></span>(<span class="st">'vignettes'</span>, <span class="st">'christensenetal-comparison-files'</span>,  <span class="st">'data_files.Rdata'</span>))</a>
<a class="sourceLine" id="cb2-12" data-line-number="12"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/load">load</a></span>(here<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/here/topics/here">here</a></span>(<span class="st">'vignettes'</span>, <span class="st">'christensenetal-comparison-files'</span>, <span class="st">'model-cache'</span>,  <span class="st">'ldas.RData'</span>))</a>
<a class="sourceLine" id="cb2-13" data-line-number="13"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/load">load</a></span>(here<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/here/topics/here">here</a></span>(<span class="st">'vignettes'</span>, <span class="st">'christensenetal-comparison-files'</span>, <span class="st">'model-cache'</span>, <span class="st">'ldats_changepoints.RData'</span>))</a>
<a class="sourceLine" id="cb2-14" data-line-number="14"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/load">load</a></span>(here<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/here/topics/here">here</a></span>(<span class="st">'vignettes'</span>, <span class="st">'christensenetal-comparison-files'</span>, <span class="st">'model-cache'</span>, <span class="st">'paper_changepoints.RData'</span>))</a></code></pre></div>
</div>
<div id="christensen-2018-analysis-files" class="section level2">
<h2 class="hasAnchor">
<a href="#christensen-2018-analysis-files" class="anchor"></a>Christensen 2018 analysis files</h2>
<p>Download Christensen 2018 analysis scripts &amp; data files from <a href="https://github.com/emchristensen/Extreme-events-LDA">Extreme-events-LDA repo:</a></p>
<p>Main Analysis Scripts:</p>
<ul>
<li><p>rodent_LDA_analysis.R main script for analyzing rodent community change using LDA</p></li>
<li><p>rodent_data_for_LDA.R contains a function that creates the rodent data table used in analyses</p></li>
<li><p>AIC_model_selection.R contains functions for calculating AIC for different candidate LDA models</p></li>
<li><p>changepointmodel.r contains change-point model code</p></li>
<li><p>LDA-distance.R function for computing Hellinger distance analyses</p></li>
</ul>
<p>Data:</p>
<ul>
<li>Rodent_table_dat.csv table of rodent data, created by rodent_data_for_LDA.R</li>
</ul>
<p>Figure scripts:</p>
<ul>
<li>LDA_figure_scripts.R contains functions for making main plots in manuscript (Fig 1). Called from rodent_LDA_analysis.R</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"></a>
<a class="sourceLine" id="cb3-2" data-line-number="2">paper_filepath &lt;-<span class="st"> </span>here<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/here/topics/here">here</a></span>(<span class="st">'vignettes'</span>, <span class="st">'christensenetal-comparison-files'</span>, <span class="st">'christensenetal-2018-files'</span>)</a>
<a class="sourceLine" id="cb3-3" data-line-number="3">test_filepath &lt;-<span class="st"> </span>here<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/here/topics/here">here</a></span>(<span class="st">'vignettes'</span>, <span class="st">'christensenetal-comparison-files'</span>, <span class="st">'christensenetal-2018-files'</span>, <span class="st">'rodent_LDA_analysis.r'</span>)</a>
<a class="sourceLine" id="cb3-4" data-line-number="4"></a>
<a class="sourceLine" id="cb3-5" data-line-number="5"><span class="cf">if</span>(<span class="op">!</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/files">file.exists</a></span>(test_filepath)) {</a>
<a class="sourceLine" id="cb3-6" data-line-number="6"></a>
<a class="sourceLine" id="cb3-7" data-line-number="7">files_to_download &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'rodent_LDA_analysis.r'</span>, <span class="st">'rodent_data_for_LDA.r'</span>, <span class="st">'AIC_model_selection.R'</span>, <span class="st">'changepointmodel.r'</span>, <span class="st">'LDA-distance.R'</span>, <span class="st">'Rodent_table_dat.csv'</span>, <span class="st">'LDA_figure_scripts.R'</span>)</a>
<a class="sourceLine" id="cb3-8" data-line-number="8"></a>
<a class="sourceLine" id="cb3-9" data-line-number="9"><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(files_to_download)) {</a>
<a class="sourceLine" id="cb3-10" data-line-number="10">  <span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/download.file">download.file</a></span>(<span class="dt">url =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste0</a></span>(<span class="st">"https://raw.githubusercontent.com/emchristensen/Extreme-events-LDA/master/"</span>, files_to_download[i]),</a>
<a class="sourceLine" id="cb3-11" data-line-number="11">                <span class="dt">destfile =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste0</a></span>(paper_filepath, <span class="st">'/'</span>, files_to_download[i]))</a>
<a class="sourceLine" id="cb3-12" data-line-number="12">}</a>
<a class="sourceLine" id="cb3-13" data-line-number="13"></a>
<a class="sourceLine" id="cb3-14" data-line-number="14"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rm">rm</a></span>(files_to_download)</a>
<a class="sourceLine" id="cb3-15" data-line-number="15"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rm">rm</a></span>(i)</a>
<a class="sourceLine" id="cb3-16" data-line-number="16"></a>
<a class="sourceLine" id="cb3-17" data-line-number="17">}</a>
<a class="sourceLine" id="cb3-18" data-line-number="18"></a>
<a class="sourceLine" id="cb3-19" data-line-number="19"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rm">rm</a></span>(test_filepath)</a>
<a class="sourceLine" id="cb3-20" data-line-number="20"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rm">rm</a></span>(paper_filepath)</a></code></pre></div>
</div>
<div id="data" class="section level2">
<h2 class="hasAnchor">
<a href="#data" class="anchor"></a>Data</h2>
<p>The Portal rodents control data is included in the LDATS package:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/data">data</a></span>(rodents)</a>
<a class="sourceLine" id="cb4-2" data-line-number="2"></a>
<a class="sourceLine" id="cb4-3" data-line-number="3"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(rodents[[<span class="dv">1</span>]])</a>
<a class="sourceLine" id="cb4-4" data-line-number="4"><span class="co">#&gt;   BA DM DO DS NA. OL OT PB PE PF PH PI PL PM PP RF RM RO SF SH SO</span></a>
<a class="sourceLine" id="cb4-5" data-line-number="5"><span class="co">#&gt; 1  0 13  0  2   2  0  0  0  1  1  0  0  0  0  3  0  0  0  0  0  0</span></a>
<a class="sourceLine" id="cb4-6" data-line-number="6"><span class="co">#&gt; 2  0 20  1  3   2  0  0  0  0  4  0  0  0  0  2  0  0  0  0  0  0</span></a>
<a class="sourceLine" id="cb4-7" data-line-number="7"><span class="co">#&gt; 3  0 21  0  8   4  0  0  0  1  2  0  0  0  0  1  0  0  0  0  0  0</span></a>
<a class="sourceLine" id="cb4-8" data-line-number="8"><span class="co">#&gt; 4  0 21  3 12   4  2  3  0  1  1  0  0  0  0  0  0  0  0  0  0  0</span></a>
<a class="sourceLine" id="cb4-9" data-line-number="9"><span class="co">#&gt; 5  0 16  1  9   5  2  1  0  0  2  0  0  0  0  0  0  1  0  0  0  0</span></a>
<a class="sourceLine" id="cb4-10" data-line-number="10"><span class="co">#&gt; 6  0 17  1 13   5  1  5  0  0  3  0  0  0  0  0  0  0  0  0  0  0</span></a></code></pre></div>
<p>Load the data used in Christensen et al:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/source">source</a></span>(here<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/here/topics/here">here</a></span>(<span class="st">'vignettes'</span>, <span class="st">'christensenetal-comparison-files'</span>, <span class="st">'christensenetal-2018-files'</span>, <span class="st">'rodent_data_for_LDA.r'</span>))</a>
<a class="sourceLine" id="cb5-2" data-line-number="2"></a>
<a class="sourceLine" id="cb5-3" data-line-number="3">dat =<span class="st"> </span><span class="kw">create_rodent_table</span>(<span class="dt">period_first =</span> <span class="dv">1</span>,</a>
<a class="sourceLine" id="cb5-4" data-line-number="4">                          <span class="dt">period_last =</span> <span class="dv">436</span>,</a>
<a class="sourceLine" id="cb5-5" data-line-number="5">                          <span class="dt">selected_plots =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">8</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">14</span>,<span class="dv">17</span>,<span class="dv">22</span>),</a>
<a class="sourceLine" id="cb5-6" data-line-number="6">                          <span class="dt">selected_species =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'BA'</span>,<span class="st">'DM'</span>,<span class="st">'DO'</span>,<span class="st">'DS'</span>,<span class="st">'NA'</span>,<span class="st">'OL'</span>,<span class="st">'OT'</span>,<span class="st">'PB'</span>,<span class="st">'PE'</span>,<span class="st">'PF'</span>,<span class="st">'PH'</span>,<span class="st">'PI'</span>,<span class="st">'PL'</span>,<span class="st">'PM'</span>,<span class="st">'PP'</span>,<span class="st">'RF'</span>,<span class="st">'RM'</span>,<span class="st">'RO'</span>,<span class="st">'SF'</span>,<span class="st">'SH'</span>,<span class="st">'SO'</span>))</a>
<a class="sourceLine" id="cb5-7" data-line-number="7"></a>
<a class="sourceLine" id="cb5-8" data-line-number="8"><span class="co"># dates to go with count data</span></a>
<a class="sourceLine" id="cb5-9" data-line-number="9">moondat =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/read.table">read.csv</a></span>(<span class="dt">text=</span><span class="kw">getURL</span>(<span class="st">"https://raw.githubusercontent.com/weecology/PortalData/master/Rodents/moon_dates.csv"</span>),<span class="dt">stringsAsFactors =</span> F)</a>
<a class="sourceLine" id="cb5-10" data-line-number="10">moondat<span class="op">$</span>date =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/as.Date">as.Date</a></span>(moondat<span class="op">$</span>censusdate)</a>
<a class="sourceLine" id="cb5-11" data-line-number="11"></a>
<a class="sourceLine" id="cb5-12" data-line-number="12">period_dates =<span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(moondat,period <span class="op">%in%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">rownames</a></span>(dat)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(period,date)</a>
<a class="sourceLine" id="cb5-13" data-line-number="13">dates =<span class="st"> </span>period_dates<span class="op">$</span>date</a>
<a class="sourceLine" id="cb5-14" data-line-number="14"></a>
<a class="sourceLine" id="cb5-15" data-line-number="15">paper_dat &lt;-<span class="st"> </span>dat</a>
<a class="sourceLine" id="cb5-16" data-line-number="16"></a>
<a class="sourceLine" id="cb5-17" data-line-number="17">paper_dates &lt;-<span class="st"> </span>dates</a>
<a class="sourceLine" id="cb5-18" data-line-number="18"></a>
<a class="sourceLine" id="cb5-19" data-line-number="19"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rm">rm</a></span>(<span class="dt">list =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'dat'</span>, <span class="st">'dates'</span>, <span class="st">'period_dates'</span>,</a>
<a class="sourceLine" id="cb5-20" data-line-number="20">            <span class="st">'create_rodent_table'</span>))</a></code></pre></div>
<p>Compare paper data to LDATS data:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"></a>
<a class="sourceLine" id="cb6-2" data-line-number="2">compare &lt;-<span class="st"> </span>rodents[[<span class="dv">1</span>]] <span class="op">==</span><span class="st"> </span>paper_dat</a>
<a class="sourceLine" id="cb6-3" data-line-number="3"></a>
<a class="sourceLine" id="cb6-4" data-line-number="4"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/which">which</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colSums">rowSums</a></span>(compare) <span class="op">&lt;</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">ncol</a></span>(compare)))</a>
<a class="sourceLine" id="cb6-5" data-line-number="5"><span class="co">#&gt; [1] 16</span></a></code></pre></div>
<p>There are 16 rows where the data included in LDATS differs from the paper data. This is because the LDATS data is not adjusted to account for trapping effort, but the paper data has divided all census counts by the actual number of plots trapped and multiplied by 8 to account for incompletely-trapped censuses.</p>
<p>To confirm this, refer to lines 36-46 in <code>rodent_data_for_LDA.r</code>:</p>
<pre><code># retrieve data on number of plots trapped per month
  trap_table = read.csv('https://raw.githubusercontent.com/weecology/PortalData/master/Rodents/Portal_rodent_trapping.csv')
  trap_table_controls = filter(trap_table, plot %in% selected_plots)
  nplots_controls = aggregate(trap_table_controls$sampled,by=list(period = trap_table_controls$period),FUN=sum)

  # adjust species counts by number of plots trapped that month
  r_table_adjusted = as.data.frame.matrix(r_table)
  for (n in 1:436) {
    #divide by number of control plots actually trapped (should be 8) and multiply by 8 to estimate captures as if all plots were trapped
    r_table_adjusted[n,] = round(r_table_adjusted[n,]/nplots_controls$x[n]*8)
  }

    return(r_table_adjusted)
</code></pre>
<p>Running the same procedure on the LDATS data, we modify 16 rows, and finish with a data frame that matches the one from the paper.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"></a>
<a class="sourceLine" id="cb8-2" data-line-number="2">trap_table =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/read.table">read.csv</a></span>(<span class="st">'https://raw.githubusercontent.com/weecology/PortalData/master/Rodents/Portal_rodent_trapping.csv'</span>)</a></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"> trap_table_controls =dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(trap_table, plot <span class="op">%in%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">8</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">14</span>,<span class="dv">17</span>,<span class="dv">22</span>))</a>
<a class="sourceLine" id="cb9-2" data-line-number="2">  nplots_controls =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/aggregate">aggregate</a></span>(trap_table_controls<span class="op">$</span>sampled,<span class="dt">by=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">period =</span> trap_table_controls<span class="op">$</span>period),<span class="dt">FUN=</span>sum)</a>
<a class="sourceLine" id="cb9-3" data-line-number="3">   <span class="co"># adjust species counts by number of plots trapped that month</span></a>
<a class="sourceLine" id="cb9-4" data-line-number="4">  ldats_rodents_adjusted =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/as.data.frame">as.data.frame.matrix</a></span>(rodents[[<span class="dv">1</span>]])</a>
<a class="sourceLine" id="cb9-5" data-line-number="5">  <span class="cf">for</span> (n <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">436</span>) {</a>
<a class="sourceLine" id="cb9-6" data-line-number="6">    <span class="co">#divide by number of control plots actually trapped (should be 8) and multiply by 8 to estimate captures as if all plots were trapped</span></a>
<a class="sourceLine" id="cb9-7" data-line-number="7">    ldats_rodents_adjusted[n,] =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Round">round</a></span>(ldats_rodents_adjusted[n,]<span class="op">/</span>nplots_controls<span class="op">$</span>x[n]<span class="op">*</span><span class="dv">8</span>)</a>
<a class="sourceLine" id="cb9-8" data-line-number="8">  }</a>
<a class="sourceLine" id="cb9-9" data-line-number="9"></a>
<a class="sourceLine" id="cb9-10" data-line-number="10"></a>
<a class="sourceLine" id="cb9-11" data-line-number="11">compare_raw &lt;-<span class="st"> </span>rodents[[<span class="dv">1</span>]] <span class="op">==</span><span class="st"> </span>ldats_rodents_adjusted</a>
<a class="sourceLine" id="cb9-12" data-line-number="12"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/which">which</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colSums">rowSums</a></span>(compare_raw) <span class="op">&lt;</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">ncol</a></span>(compare_raw)))</a>
<a class="sourceLine" id="cb9-13" data-line-number="13"><span class="co">#&gt; [1] 16</span></a>
<a class="sourceLine" id="cb9-14" data-line-number="14"></a>
<a class="sourceLine" id="cb9-15" data-line-number="15">compare_adjusted &lt;-<span class="st"> </span>ldats_rodents_adjusted <span class="op">==</span><span class="st"> </span>paper_dat</a>
<a class="sourceLine" id="cb9-16" data-line-number="16"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/which">which</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colSums">rowSums</a></span>(compare_adjusted) <span class="op">&lt;</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">ncol</a></span>(compare_adjusted)))</a>
<a class="sourceLine" id="cb9-17" data-line-number="17"><span class="co">#&gt; [1] 0</span></a></code></pre></div>
<p>Because the LDA procedure weights the information from documents (census periods) according to the number of words (rodents captured), we now believe it is most appropriate to run the LDA on <em>unadjusted</em> trapping data, and we recommend that users of LDATS do so. However, to maintain consistency with Christensen et al 2018, we will proceed using the <em>adjusted</em> rodent table in this vignette.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">rodents[[<span class="dv">1</span>]] &lt;-<span class="st"> </span>paper_dat</a></code></pre></div>
<p>The LDATS rodent data comes with a <code>document_covariate_table</code>, which we will use later as the predictor variables for the changepoint models. In this table, time is expressed as new moon numbers. Later we will want to be able to interpret the results in terms of census dates. We will add a column to the <code>document_covariate_table</code> to convert new moon numbers to census dates. We will not reference this column in any of the formulas we pass to the changepoint models, so it will be ignored until we need it.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"></a>
<a class="sourceLine" id="cb11-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(rodents<span class="op">$</span>document_covariate_table)</a>
<a class="sourceLine" id="cb11-3" data-line-number="3"><span class="co">#&gt;   newmoon sin_year cos_year</span></a>
<a class="sourceLine" id="cb11-4" data-line-number="4"><span class="co">#&gt; 1       1  -0.2470  -0.9690</span></a>
<a class="sourceLine" id="cb11-5" data-line-number="5"><span class="co">#&gt; 2       2  -0.6808  -0.7325</span></a>
<a class="sourceLine" id="cb11-6" data-line-number="6"><span class="co">#&gt; 3       3  -0.9537  -0.3008</span></a>
<a class="sourceLine" id="cb11-7" data-line-number="7"><span class="co">#&gt; 4       4  -0.9813   0.1925</span></a>
<a class="sourceLine" id="cb11-8" data-line-number="8"><span class="co">#&gt; 5       5  -0.7583   0.6519</span></a>
<a class="sourceLine" id="cb11-9" data-line-number="9"><span class="co">#&gt; 6       6  -0.3537   0.9354</span></a>
<a class="sourceLine" id="cb11-10" data-line-number="10"></a>
<a class="sourceLine" id="cb11-11" data-line-number="11">moondat &lt;-<span class="st"> </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(moondat, newmoonnumber, censusdate)</a>
<a class="sourceLine" id="cb11-12" data-line-number="12"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">colnames</a></span>(moondat) &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">'newmoon'</span>, <span class="st">'censusdate'</span>)</a>
<a class="sourceLine" id="cb11-13" data-line-number="13"></a>
<a class="sourceLine" id="cb11-14" data-line-number="14">new_cov_table &lt;-<span class="st"> </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/join.html">left_join</a></span>(rodents<span class="op">$</span>document_covariate_table, moondat, <span class="dt">by =</span> <span class="st">'newmoon'</span>)</a>
<a class="sourceLine" id="cb11-15" data-line-number="15"></a>
<a class="sourceLine" id="cb11-16" data-line-number="16">rodents<span class="op">$</span>document_covariate_table &lt;-<span class="st"> </span>new_cov_table</a></code></pre></div>
</div>
<div id="stage-1-lda" class="section level2">
<h2 class="hasAnchor">
<a href="#stage-1-lda" class="anchor"></a>Stage 1: LDA</h2>
<p>While LDATS can run start-to-finish with <code><a href="../reference/LDA_TS.html">LDATS::LDA_TS</a></code>, here we will work through the process function-by-function to isolate differences with the paper. For a breakdown of the <code>LDA_TS</code> pipeline, see the <a href="https://weecology.github.io/LDATS/articles/LDATS_codebase.html"><code>codebase</code> vignette</a>.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1"></a>
<a class="sourceLine" id="cb12-2" data-line-number="2">ldats_ldas &lt;-<span class="st"> </span>LDATS<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/LDATS/topics/LDA_set">LDA_set</a></span>(<span class="dt">document_term_table =</span> rodents<span class="op">$</span>document_term_table, <span class="dt">topics =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">2</span><span class="op">:</span><span class="dv">6</span>), <span class="dt">nseeds =</span> <span class="dv">100</span>)</a>
<a class="sourceLine" id="cb12-3" data-line-number="3">ldats_lda_selected &lt;-<span class="st"> </span>LDATS<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/LDATS/topics/select_LDA">select_LDA</a></span>(<span class="dt">LDA_models =</span> ldats_ldas)</a>
<a class="sourceLine" id="cb12-4" data-line-number="4"></a>
<a class="sourceLine" id="cb12-5" data-line-number="5"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/save">save</a></span>(ldats_ldas, <span class="dt">file =</span> here<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/here/topics/here">here</a></span>(<span class="st">'vignettes'</span>, <span class="st">'christensenetal-comparison-files'</span>, <span class="st">'model-cache'</span>, <span class="st">'ldats_ldas.Rds'</span>))</a>
<a class="sourceLine" id="cb12-6" data-line-number="6"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/save">save</a></span>(ldats_lda_selected, <span class="dt">file =</span> here<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/here/topics/here">here</a></span>(<span class="st">'vignettes'</span>, <span class="st">'christensenetal-comparison-files'</span>, <span class="st">'model-cache'</span>, <span class="st">'ldats_lda_selected.Rds'</span>))</a></code></pre></div>
<p>Paper LDAS:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/source">source</a></span>(here<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/here/topics/here">here</a></span>(<span class="st">'vignettes'</span>, <span class="st">'christensenetal-comparison-files'</span>, <span class="st">'christensenetal-2018-files'</span>, <span class="st">'AIC_model_selection.R'</span>))</a>
<a class="sourceLine" id="cb13-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/source">source</a></span>(here<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/here/topics/here">here</a></span>(<span class="st">'vignettes'</span>, <span class="st">'christensenetal-comparison-files'</span>, <span class="st">'christensenetal-2018-files'</span>, <span class="st">'LDA-distance.R'</span>))</a>
<a class="sourceLine" id="cb13-3" data-line-number="3"></a>
<a class="sourceLine" id="cb13-4" data-line-number="4"><span class="co"># Fit a bunch of LDA models with different seeds</span></a>
<a class="sourceLine" id="cb13-5" data-line-number="5"><span class="co"># Only use even numbers for seeds because consecutive seeds give identical results</span></a>
<a class="sourceLine" id="cb13-6" data-line-number="6">seeds =<span class="st"> </span><span class="dv">2</span><span class="op">*</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq">seq</a></span>(<span class="dv">200</span>)</a>
<a class="sourceLine" id="cb13-7" data-line-number="7"></a>
<a class="sourceLine" id="cb13-8" data-line-number="8"><span class="co"># repeat LDA model fit and AIC calculation with a bunch of different seeds to test robustness of the analysis</span></a>
<a class="sourceLine" id="cb13-9" data-line-number="9">best_ntopic =<span class="st"> </span><span class="kw">repeat_VEM</span>(paper_dat,</a>
<a class="sourceLine" id="cb13-10" data-line-number="10">                         seeds,</a>
<a class="sourceLine" id="cb13-11" data-line-number="11">                         <span class="dt">topic_min=</span><span class="dv">2</span>,</a>
<a class="sourceLine" id="cb13-12" data-line-number="12">                         <span class="dt">topic_max=</span><span class="dv">6</span>)</a>
<a class="sourceLine" id="cb13-13" data-line-number="13"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/hist">hist</a></span>(best_ntopic<span class="op">$</span>k,<span class="dt">breaks=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="fl">0.5</span>,<span class="fl">1.5</span>,<span class="fl">2.5</span>,<span class="fl">3.5</span>,<span class="fl">4.5</span>,<span class="fl">5.5</span>,<span class="fl">6.5</span>,<span class="fl">7.5</span>,<span class="fl">8.5</span>,<span class="fl">9.5</span>),<span class="dt">xlab=</span><span class="st">'best # of topics'</span>, <span class="dt">main=</span><span class="st">''</span>)</a>
<a class="sourceLine" id="cb13-14" data-line-number="14"></a>
<a class="sourceLine" id="cb13-15" data-line-number="15"><span class="co"># 2b. how different is species composition of 4 community-types when LDA is run with different seeds?</span></a>
<a class="sourceLine" id="cb13-16" data-line-number="16"><span class="co"># ==================================================================</span></a>
<a class="sourceLine" id="cb13-17" data-line-number="17"><span class="co"># get the best 100 seeds where 4 topics was the best LDA model</span></a>
<a class="sourceLine" id="cb13-18" data-line-number="18">seeds_4topics =<span class="st"> </span>best_ntopic <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb13-19" data-line-number="19"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(k <span class="op">==</span><span class="st"> </span><span class="dv">4</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb13-20" data-line-number="20"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span>(aic) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb13-21" data-line-number="21"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(<span class="dv">100</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb13-22" data-line-number="22"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span>(SEED)</a>
<a class="sourceLine" id="cb13-23" data-line-number="23"></a>
<a class="sourceLine" id="cb13-24" data-line-number="24"><span class="co"># choose seed with highest log likelihood for all following analyses</span></a>
<a class="sourceLine" id="cb13-25" data-line-number="25"><span class="co">#    (also produces plot of community composition for 'best' run compared to 'worst')</span></a>
<a class="sourceLine" id="cb13-26" data-line-number="26">best_seed =<span class="st"> </span><span class="kw">calculate_LDA_distance</span>(paper_dat,seeds_4topics)</a>
<a class="sourceLine" id="cb13-27" data-line-number="27">mean_dist =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/unlist">unlist</a></span>(best_seed)[<span class="dv">2</span>]</a>
<a class="sourceLine" id="cb13-28" data-line-number="28">max_dist =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/unlist">unlist</a></span>(best_seed)[<span class="dv">3</span>]</a>
<a class="sourceLine" id="cb13-29" data-line-number="29"></a>
<a class="sourceLine" id="cb13-30" data-line-number="30"><span class="co"># ==================================================================</span></a>
<a class="sourceLine" id="cb13-31" data-line-number="31"><span class="co"># 3. run LDA model</span></a>
<a class="sourceLine" id="cb13-32" data-line-number="32"><span class="co"># ==================================================================</span></a>
<a class="sourceLine" id="cb13-33" data-line-number="33">ntopics =<span class="st"> </span><span class="dv">4</span></a>
<a class="sourceLine" id="cb13-34" data-line-number="34">SEED =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/unlist">unlist</a></span>(best_seed)[<span class="dv">1</span>]  <span class="co"># For the paper, use seed 206</span></a>
<a class="sourceLine" id="cb13-35" data-line-number="35">ldamodel =<span class="st"> </span><span class="kw">LDA</span>(paper_dat,ntopics, <span class="dt">control =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">seed =</span> SEED),<span class="dt">method=</span><span class="st">'VEM'</span>)</a>
<a class="sourceLine" id="cb13-36" data-line-number="36"></a>
<a class="sourceLine" id="cb13-37" data-line-number="37"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/save">save</a></span>(ldamodel,<span class="dt">file =</span> here<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/here/topics/here">here</a></span>(<span class="st">'vignettes'</span>, <span class="st">'christensenetal-comparison-files'</span>, <span class="st">'model-cache'</span>, <span class="st">'paper_ldamodel.Rds'</span>))</a></code></pre></div>
<div id="plot-ldas" class="section level3">
<h3 class="hasAnchor">
<a href="#plot-ldas" class="anchor"></a>Plot LDAS</h3>
<div id="paper-lda" class="section level4">
<h4 class="hasAnchor">
<a href="#paper-lda" class="anchor"></a>Paper LDA</h4>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1"><span class="co"># Paper</span></a>
<a class="sourceLine" id="cb14-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(ldamodel, <span class="dt">cols =</span> <span class="ot">NULL</span>, <span class="dt">option =</span> <span class="st">"D"</span>)</a></code></pre></div>
<p><img src="paper-comparison_files/figure-html/plot%20paper%20LDA-1.png" width="672"></p>
</div>
<div id="ldats-lda" class="section level4">
<h4 class="hasAnchor">
<a href="#ldats-lda" class="anchor"></a>LDATS LDA</h4>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1"><span class="co"># LDATS</span></a>
<a class="sourceLine" id="cb15-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(ldats_lda_selected[[<span class="dv">1</span>]], <span class="dt">cols =</span> <span class="ot">NULL</span>, <span class="dt">option =</span> <span class="st">"D"</span>)</a></code></pre></div>
<p><img src="paper-comparison_files/figure-html/plot%20LDATS%20LDA-1.png" width="672"></p>
<p>The paper method finds 4 topics and LDATS finds 6. This is because of an update to the model selection procedure. The paper conservatively overestimates the number of parameters (by counting all of the variational parameteres) and therefore overpenalizes the AIC for models with more topics. Comparatively, the LDATS method now uses the number of parameters remaining after the variational approximation, as returned by the LDA object. For this vignette, we will compare the results from using both LDA models.</p>
</div>
</div>
</div>
<div id="changepoint-models" class="section level2">
<h2 class="hasAnchor">
<a href="#changepoint-models" class="anchor"></a>Changepoint models</h2>
<p>We will compare four combinations of LDA + changepoint models:</p>
<ul>
<li>LDATS LDA + LDATS changepoint</li>
<li>LDATS LDA + paper changepoint</li>
<li>Paper LDA + LDATS changepoint</li>
<li>Paper LDA + paper changepoint</li>
</ul>
<p>Having divided the data to generate catch-per-effort, the paper changepoint model weighted all sample periods equally. In comparison, LDATS does not force an equal weighting, but assumes that as default, and can weight sample periods according to how many individuals were captured (controlled by the <code>weights</code> argument to <code>LDA_TS</code>, and easily calculated for a document-term matrix using <code>document_term_weights</code>. We now believe it is more appropriate to weight periods proportional to captures in the time series (despite the LDA function returning only proportions of each topic), and this is what we recommend for LDATS users. For the purposes of comparison, however, we will continue set all weights = 1 for both changepoint models. For an example of LDATS run with proportional weights, see the <a href="https://weecology.github.io/LDATS/articles/rodents-example.html">rodents vignette</a>.</p>
<div id="running-paper-changepoint-models" class="section level3">
<h3 class="hasAnchor">
<a href="#running-paper-changepoint-models" class="anchor"></a>Running paper changepoint models</h3>
<div id="ldats-lda-and-paper-changepoint" class="section level4">
<h4 class="hasAnchor">
<a href="#ldats-lda-and-paper-changepoint" class="anchor"></a>LDATS LDA and paper changepoint</h4>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1">#### Run changepoint ####</a>
<a class="sourceLine" id="cb16-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/source">source</a></span>(here<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/here/topics/here">here</a></span>(<span class="st">'vignettes'</span>, <span class="st">'christensenetal-comparison-files'</span>, <span class="st">'christensenetal-2018-files'</span>, <span class="st">'changepointmodel.r'</span>))</a>
<a class="sourceLine" id="cb16-3" data-line-number="3"></a>
<a class="sourceLine" id="cb16-4" data-line-number="4"><span class="co"># set up parameters for model</span></a>
<a class="sourceLine" id="cb16-5" data-line-number="5">year_continuous =<span class="st"> </span><span class="dv">1970</span> <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/integer">as.integer</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/weekday.POSIXt">julian</a></span>(paper_dates)) <span class="op">/</span><span class="st"> </span><span class="fl">365.25</span></a>
<a class="sourceLine" id="cb16-6" data-line-number="6">x =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/data.frame">data.frame</a></span>(</a>
<a class="sourceLine" id="cb16-7" data-line-number="7">  <span class="dt">year_continuous =</span> year_continuous,</a>
<a class="sourceLine" id="cb16-8" data-line-number="8">  <span class="dt">sin_year =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Trig">sin</a></span>(year_continuous <span class="op">*</span><span class="st"> </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>pi),</a>
<a class="sourceLine" id="cb16-9" data-line-number="9">  <span class="dt">cos_year =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Trig">cos</a></span>(year_continuous <span class="op">*</span><span class="st"> </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>pi)</a>
<a class="sourceLine" id="cb16-10" data-line-number="10">)</a>
<a class="sourceLine" id="cb16-11" data-line-number="11"></a>
<a class="sourceLine" id="cb16-12" data-line-number="12"><span class="co"># run models with 1, 2, 3, 4, 5, 6 changepoints</span></a>
<a class="sourceLine" id="cb16-13" data-line-number="13">ldats_paper_cp_results_rodent =<span class="st"> </span><span class="kw">changepoint_model</span>(ldats_lda_selected[[<span class="dv">1</span>]], x, <span class="dv">1</span>, <span class="dt">weights =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="dv">1</span>,<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(year_continuous)))</a>
<a class="sourceLine" id="cb16-14" data-line-number="14"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/save">save</a></span>(ldats_paper_cp_results_rodent, <span class="dt">file =</span> here<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/here/topics/here">here</a></span>(<span class="st">'vignettes'</span>, <span class="st">'christensenetal-comparison-files'</span>, <span class="st">'model-cache'</span>, <span class="st">'ldats_paper_1.Rds'</span>))</a>
<a class="sourceLine" id="cb16-15" data-line-number="15"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rm">rm</a></span>(ldats_paper_cp_results_rodent)</a>
<a class="sourceLine" id="cb16-16" data-line-number="16"></a>
<a class="sourceLine" id="cb16-17" data-line-number="17">ldats_paper_cp_results_rodent2 =<span class="st"> </span><span class="kw">changepoint_model</span>(ldats_lda_selected[[<span class="dv">1</span>]], x, <span class="dv">2</span>, <span class="dt">weights =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="dv">1</span>,<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(year_continuous)))</a>
<a class="sourceLine" id="cb16-18" data-line-number="18"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/save">save</a></span>(ldats_paper_cp_results_rodent2, <span class="dt">file =</span> here<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/here/topics/here">here</a></span>(<span class="st">'vignettes'</span>, <span class="st">'christensenetal-comparison-files'</span>, <span class="st">'model-cache'</span>, <span class="st">'ldats_paper_2.Rds'</span>))</a>
<a class="sourceLine" id="cb16-19" data-line-number="19"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rm">rm</a></span>(ldats_paper_cp_results_rodent2)</a>
<a class="sourceLine" id="cb16-20" data-line-number="20"></a>
<a class="sourceLine" id="cb16-21" data-line-number="21">ldats_paper_cp_results_rodent3 =<span class="st"> </span><span class="kw">changepoint_model</span>(ldats_lda_selected[[<span class="dv">1</span>]], x, <span class="dv">3</span>, <span class="dt">weights =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="dv">1</span>,<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(year_continuous)))</a>
<a class="sourceLine" id="cb16-22" data-line-number="22"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/save">save</a></span>(ldats_paper_cp_results_rodent3, <span class="dt">file =</span> here<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/here/topics/here">here</a></span>(<span class="st">'vignettes'</span>, <span class="st">'christensenetal-comparison-files'</span>, <span class="st">'model-cache'</span>, <span class="st">'ldats_paper_3.Rds'</span>))</a>
<a class="sourceLine" id="cb16-23" data-line-number="23"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rm">rm</a></span>(ldats_paper_cp_results_rodent3)</a>
<a class="sourceLine" id="cb16-24" data-line-number="24"></a>
<a class="sourceLine" id="cb16-25" data-line-number="25">ldats_paper_cp_results_rodent4 =<span class="st"> </span><span class="kw">changepoint_model</span>(ldats_lda_selected[[<span class="dv">1</span>]], x, <span class="dv">4</span>, <span class="dt">weights =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="dv">1</span>,<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(year_continuous)))</a>
<a class="sourceLine" id="cb16-26" data-line-number="26"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/save">save</a></span>(ldats_paper_cp_results_rodent4, <span class="dt">file =</span> here<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/here/topics/here">here</a></span>(<span class="st">'vignettes'</span>, <span class="st">'christensenetal-comparison-files'</span>, <span class="st">'model-cache'</span>, <span class="st">'ldats_paper_4.Rds'</span>))</a>
<a class="sourceLine" id="cb16-27" data-line-number="27"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rm">rm</a></span>(ldats_paper_cp_results_rodent4)</a>
<a class="sourceLine" id="cb16-28" data-line-number="28"></a>
<a class="sourceLine" id="cb16-29" data-line-number="29">ldats_paper_cp_results_rodent5 =<span class="st"> </span><span class="kw">changepoint_model</span>(ldats_lda_selected[[<span class="dv">1</span>]], x, <span class="dv">5</span>, <span class="dt">weights =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="dv">1</span>,<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(year_continuous)))</a>
<a class="sourceLine" id="cb16-30" data-line-number="30"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/save">save</a></span>(ldats_paper_cp_results_rodent5, <span class="dt">file =</span> here<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/here/topics/here">here</a></span>(<span class="st">'vignettes'</span>, <span class="st">'christensenetal-comparison-files'</span>, <span class="st">'model-cache'</span>, <span class="st">'ldats_paper_5.Rds'</span>))</a>
<a class="sourceLine" id="cb16-31" data-line-number="31"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rm">rm</a></span>(ldats_paper_cp_results_rodent5)</a>
<a class="sourceLine" id="cb16-32" data-line-number="32"></a>
<a class="sourceLine" id="cb16-33" data-line-number="33">ldats_paper_cp_results_rodent6 =<span class="st"> </span><span class="kw">changepoint_model</span>(ldats_lda_selected[[<span class="dv">1</span>]], x, <span class="dv">6</span>, <span class="dt">weights =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="dv">1</span>,<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(year_continuous)))</a>
<a class="sourceLine" id="cb16-34" data-line-number="34"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/save">save</a></span>(ldats_paper_cp_results_rodent6, <span class="dt">file =</span> here<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/here/topics/here">here</a></span>(<span class="st">'vignettes'</span>, <span class="st">'christensenetal-comparison-files'</span>, <span class="st">'model-cache'</span>, <span class="st">'ldats_paper_6.Rds'</span>))</a>
<a class="sourceLine" id="cb16-35" data-line-number="35"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rm">rm</a></span>(ldats_paper_cp_results_rodent6)</a></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1">#### Changepoint model selection ####</a>
<a class="sourceLine" id="cb17-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/load">load</a></span>(here<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/here/topics/here">here</a></span>(<span class="st">'vignettes'</span>, <span class="st">'christensenetal-comparison-files'</span>, <span class="st">'model-cache'</span>, <span class="st">'ldats_paper_1.Rds'</span>))</a>
<a class="sourceLine" id="cb17-3" data-line-number="3"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/load">load</a></span>(here<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/here/topics/here">here</a></span>(<span class="st">'vignettes'</span>, <span class="st">'christensenetal-comparison-files'</span>, <span class="st">'model-cache'</span>, <span class="st">'ldats_paper_2.Rds'</span>))</a>
<a class="sourceLine" id="cb17-4" data-line-number="4"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/load">load</a></span>(here<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/here/topics/here">here</a></span>(<span class="st">'vignettes'</span>, <span class="st">'christensenetal-comparison-files'</span>, <span class="st">'model-cache'</span>, <span class="st">'ldats_paper_3.Rds'</span>))</a>
<a class="sourceLine" id="cb17-5" data-line-number="5"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/load">load</a></span>(here<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/here/topics/here">here</a></span>(<span class="st">'vignettes'</span>, <span class="st">'christensenetal-comparison-files'</span>, <span class="st">'model-cache'</span>, <span class="st">'ldats_paper_4.Rds'</span>))</a>
<a class="sourceLine" id="cb17-6" data-line-number="6"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/load">load</a></span>(here<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/here/topics/here">here</a></span>(<span class="st">'vignettes'</span>, <span class="st">'christensenetal-comparison-files'</span>, <span class="st">'model-cache'</span>, <span class="st">'ldats_paper_5.Rds'</span>))</a>
<a class="sourceLine" id="cb17-7" data-line-number="7"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/load">load</a></span>(here<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/here/topics/here">here</a></span>(<span class="st">'vignettes'</span>, <span class="st">'christensenetal-comparison-files'</span>, <span class="st">'model-cache'</span>, <span class="st">'ldats_paper_6.Rds'</span>))</a></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1">ntopics =<span class="st"> </span>ldats_lda_selected[[<span class="dv">1</span>]]<span class="op">@</span>k</a>
<a class="sourceLine" id="cb18-2" data-line-number="2"></a>
<a class="sourceLine" id="cb18-3" data-line-number="3"><span class="co"># change point model selection</span></a>
<a class="sourceLine" id="cb18-4" data-line-number="4"><span class="co"># mean deviance ( -2 * log likelihood) + 2*(#parameters)</span></a>
<a class="sourceLine" id="cb18-5" data-line-number="5"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/mean">mean</a></span>(ldats_paper_cp_results_rodent<span class="op">$</span>saved_lls <span class="op">*</span><span class="st"> </span><span class="dv">-2</span>) <span class="op">+</span><span class="st"> </span><span class="dv">2</span><span class="op">*</span>(<span class="dv">3</span><span class="op">*</span>(ntopics<span class="dv">-1</span>)<span class="op">*</span>(<span class="dv">1</span><span class="op">+</span><span class="dv">1</span>)<span class="op">+</span>(<span class="dv">1</span>))</a>
<a class="sourceLine" id="cb18-6" data-line-number="6"><span class="co">#&gt; [1] 1340.817</span></a>
<a class="sourceLine" id="cb18-7" data-line-number="7"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/mean">mean</a></span>(ldats_paper_cp_results_rodent2<span class="op">$</span>saved_lls <span class="op">*</span><span class="st"> </span><span class="dv">-2</span>)<span class="op">+</span><span class="st"> </span><span class="dv">2</span><span class="op">*</span>(<span class="dv">3</span><span class="op">*</span>(ntopics<span class="dv">-1</span>)<span class="op">*</span>(<span class="dv">2</span><span class="op">+</span><span class="dv">1</span>)<span class="op">+</span>(<span class="dv">2</span>))</a>
<a class="sourceLine" id="cb18-8" data-line-number="8"><span class="co">#&gt; [1] 1306.495</span></a>
<a class="sourceLine" id="cb18-9" data-line-number="9"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/mean">mean</a></span>(ldats_paper_cp_results_rodent3<span class="op">$</span>saved_lls <span class="op">*</span><span class="st"> </span><span class="dv">-2</span>)<span class="op">+</span><span class="st"> </span><span class="dv">2</span><span class="op">*</span>(<span class="dv">3</span><span class="op">*</span>(ntopics<span class="dv">-1</span>)<span class="op">*</span>(<span class="dv">3</span><span class="op">+</span><span class="dv">1</span>)<span class="op">+</span>(<span class="dv">3</span>))</a>
<a class="sourceLine" id="cb18-10" data-line-number="10"><span class="co">#&gt; [1] 1285.447</span></a>
<a class="sourceLine" id="cb18-11" data-line-number="11"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/mean">mean</a></span>(ldats_paper_cp_results_rodent4<span class="op">$</span>saved_lls <span class="op">*</span><span class="st"> </span><span class="dv">-2</span>)<span class="op">+</span><span class="st"> </span><span class="dv">2</span><span class="op">*</span>(<span class="dv">3</span><span class="op">*</span>(ntopics<span class="dv">-1</span>)<span class="op">*</span>(<span class="dv">4</span><span class="op">+</span><span class="dv">1</span>)<span class="op">+</span>(<span class="dv">4</span>))</a>
<a class="sourceLine" id="cb18-12" data-line-number="12"><span class="co">#&gt; [1] 1276.232</span></a>
<a class="sourceLine" id="cb18-13" data-line-number="13"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/mean">mean</a></span>(ldats_paper_cp_results_rodent5<span class="op">$</span>saved_lls <span class="op">*</span><span class="st"> </span><span class="dv">-2</span>)<span class="op">+</span><span class="st"> </span><span class="dv">2</span><span class="op">*</span>(<span class="dv">3</span><span class="op">*</span>(ntopics<span class="dv">-1</span>)<span class="op">*</span>(<span class="dv">5</span><span class="op">+</span><span class="dv">1</span>)<span class="op">+</span>(<span class="dv">5</span>))</a>
<a class="sourceLine" id="cb18-14" data-line-number="14"><span class="co">#&gt; [1] 1287.485</span></a>
<a class="sourceLine" id="cb18-15" data-line-number="15"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/mean">mean</a></span>(ldats_paper_cp_results_rodent6<span class="op">$</span>saved_lls <span class="op">*</span><span class="st"> </span><span class="dv">-2</span>)<span class="op">+</span><span class="st"> </span><span class="dv">2</span><span class="op">*</span>(<span class="dv">3</span><span class="op">*</span>(ntopics<span class="dv">-1</span>)<span class="op">*</span>(<span class="dv">6</span><span class="op">+</span><span class="dv">1</span>)<span class="op">+</span>(<span class="dv">6</span>))</a>
<a class="sourceLine" id="cb18-16" data-line-number="16"><span class="co">#&gt; [1] 1302.126</span></a>
<a class="sourceLine" id="cb18-17" data-line-number="17"></a>
<a class="sourceLine" id="cb18-18" data-line-number="18"><span class="co"># The lowest deviance is for 4 changepoints.</span></a>
<a class="sourceLine" id="cb18-19" data-line-number="19"></a>
<a class="sourceLine" id="cb18-20" data-line-number="20">ldats_paper_cpt_selected =<span class="st"> </span>ldats_paper_cp_results_rodent4</a>
<a class="sourceLine" id="cb18-21" data-line-number="21"></a>
<a class="sourceLine" id="cb18-22" data-line-number="22">df_<span class="dv">4</span> =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/as.data.frame">as.data.frame</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/t">t</a></span>(ldats_paper_cpt_selected<span class="op">$</span>saved[,<span class="dv">1</span>,])) <span class="op">%&gt;%</span><span class="st"> </span>reshape<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/reshape/topics/melt-24">melt</a></span>()</a>
<a class="sourceLine" id="cb18-23" data-line-number="23"><span class="co">#&gt; Using  as id variables</span></a>
<a class="sourceLine" id="cb18-24" data-line-number="24">year_continuous =<span class="st"> </span><span class="dv">1970</span> <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/integer">as.integer</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/weekday.POSIXt">julian</a></span>(paper_dates)) <span class="op">/</span><span class="st"> </span><span class="fl">365.25</span></a>
<a class="sourceLine" id="cb18-25" data-line-number="25">df_<span class="dv">4</span><span class="op">$</span>value =<span class="st"> </span>year_continuous[df_<span class="dv">4</span><span class="op">$</span>value]</a>
<a class="sourceLine" id="cb18-26" data-line-number="26"></a>
<a class="sourceLine" id="cb18-27" data-line-number="27"></a>
<a class="sourceLine" id="cb18-28" data-line-number="28">ldats_paper_cpt_dates &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/vector">vector</a></span>(<span class="dt">length =</span> <span class="dv">4</span>)</a>
<a class="sourceLine" id="cb18-29" data-line-number="29">ldats_paper_cpt_dates[<span class="dv">1</span>] &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/mean">mean</a></span>(df_<span class="dv">4</span>[df_<span class="dv">4</span><span class="op">$</span>variable<span class="op">==</span><span class="st">'V1'</span>,<span class="st">'value'</span>]) <span class="op">%&gt;%</span><span class="st"> </span>lubridate<span class="op">::</span><span class="kw"><a href="http://lubridate.tidyverse.org/reference/date_decimal.html">date_decimal</a></span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/format">format</a></span>(<span class="st">'%Y-%m-%d'</span>)</a>
<a class="sourceLine" id="cb18-30" data-line-number="30">ldats_paper_cpt_dates[<span class="dv">2</span>] &lt;-<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/mean">mean</a></span>(df_<span class="dv">4</span>[df_<span class="dv">4</span><span class="op">$</span>variable<span class="op">==</span><span class="st">'V2'</span>,<span class="st">'value'</span>]) <span class="op">%&gt;%</span><span class="st"> </span>lubridate<span class="op">::</span><span class="kw"><a href="http://lubridate.tidyverse.org/reference/date_decimal.html">date_decimal</a></span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/format">format</a></span>(<span class="st">'%Y-%m-%d'</span>)</a>
<a class="sourceLine" id="cb18-31" data-line-number="31">ldats_paper_cpt_dates[<span class="dv">3</span>] &lt;-<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/mean">mean</a></span>(df_<span class="dv">4</span>[df_<span class="dv">4</span><span class="op">$</span>variable<span class="op">==</span><span class="st">'V3'</span>,<span class="st">'value'</span>]) <span class="op">%&gt;%</span><span class="st"> </span>lubridate<span class="op">::</span><span class="kw"><a href="http://lubridate.tidyverse.org/reference/date_decimal.html">date_decimal</a></span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/format">format</a></span>(<span class="st">'%Y-%m-%d'</span>)</a>
<a class="sourceLine" id="cb18-32" data-line-number="32">ldats_paper_cpt_dates[<span class="dv">4</span>] &lt;-<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/mean">mean</a></span>(df_<span class="dv">4</span>[df_<span class="dv">4</span><span class="op">$</span>variable<span class="op">==</span><span class="st">'V4'</span>,<span class="st">'value'</span>]) <span class="op">%&gt;%</span><span class="st"> </span>lubridate<span class="op">::</span><span class="kw"><a href="http://lubridate.tidyverse.org/reference/date_decimal.html">date_decimal</a></span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/format">format</a></span>(<span class="st">'%Y-%m-%d'</span>)</a>
<a class="sourceLine" id="cb18-33" data-line-number="33"></a>
<a class="sourceLine" id="cb18-34" data-line-number="34">ldats_paper_cpt_dates</a>
<a class="sourceLine" id="cb18-35" data-line-number="35"><span class="co">#&gt; [1] "1984-01-10" "1991-06-03" "1999-01-03" "2009-11-07"</span></a></code></pre></div>
</div>
<div id="paper-lda-and-paper-changepoint" class="section level4">
<h4 class="hasAnchor">
<a href="#paper-lda-and-paper-changepoint" class="anchor"></a>Paper LDA and paper changepoint</h4>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1"></a>
<a class="sourceLine" id="cb19-2" data-line-number="2">#### Load LDA ####</a>
<a class="sourceLine" id="cb19-3" data-line-number="3"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/load">load</a></span>(here<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/here/topics/here">here</a></span>(<span class="st">'vignettes'</span>, <span class="st">'christensenetal-comparison-files'</span>, <span class="st">'model-cache'</span>, <span class="st">'paper_ldamodel.Rds'</span>))</a></code></pre></div>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1">#### Run changepoint ####</a>
<a class="sourceLine" id="cb20-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/source">source</a></span>(here<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/here/topics/here">here</a></span>(<span class="st">'vignettes'</span>, <span class="st">'christensenetal-comparison-files'</span>, <span class="st">'christensenetal-2018-files'</span>, <span class="st">'changepointmodel.r'</span>))</a>
<a class="sourceLine" id="cb20-3" data-line-number="3"></a>
<a class="sourceLine" id="cb20-4" data-line-number="4"><span class="co"># set up parameters for model</span></a>
<a class="sourceLine" id="cb20-5" data-line-number="5">year_continuous =<span class="st"> </span><span class="dv">1970</span> <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/integer">as.integer</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/weekday.POSIXt">julian</a></span>(paper_dates)) <span class="op">/</span><span class="st"> </span><span class="fl">365.25</span></a>
<a class="sourceLine" id="cb20-6" data-line-number="6">x =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/data.frame">data.frame</a></span>(</a>
<a class="sourceLine" id="cb20-7" data-line-number="7">  <span class="dt">year_continuous =</span> year_continuous,</a>
<a class="sourceLine" id="cb20-8" data-line-number="8">  <span class="dt">sin_year =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Trig">sin</a></span>(year_continuous <span class="op">*</span><span class="st"> </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>pi),</a>
<a class="sourceLine" id="cb20-9" data-line-number="9">  <span class="dt">cos_year =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Trig">cos</a></span>(year_continuous <span class="op">*</span><span class="st"> </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>pi)</a>
<a class="sourceLine" id="cb20-10" data-line-number="10">)</a>
<a class="sourceLine" id="cb20-11" data-line-number="11"></a>
<a class="sourceLine" id="cb20-12" data-line-number="12"><span class="co"># run models with 1, 2, 3, 4, 5, 6 changepoints</span></a>
<a class="sourceLine" id="cb20-13" data-line-number="13">paper_paper_cp_results_rodent =<span class="st"> </span><span class="kw">changepoint_model</span>(ldamodel, x, <span class="dv">1</span>, <span class="dt">weights =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="dv">1</span>,<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(year_continuous)))</a>
<a class="sourceLine" id="cb20-14" data-line-number="14"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/save">save</a></span>(paper_paper_cp_results_rodent, <span class="dt">file =</span> here<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/here/topics/here">here</a></span>(<span class="st">'vignettes'</span>, <span class="st">'christensenetal-comparison-files'</span>, <span class="st">'model-cache'</span>, <span class="st">'paper_paper_1.Rds'</span>))</a>
<a class="sourceLine" id="cb20-15" data-line-number="15"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rm">rm</a></span>(paper_paper_cp_results_rodent)</a>
<a class="sourceLine" id="cb20-16" data-line-number="16"></a>
<a class="sourceLine" id="cb20-17" data-line-number="17">paper_paper_cp_results_rodent2 =<span class="st"> </span><span class="kw">changepoint_model</span>(ldamodel, x, <span class="dv">2</span>, <span class="dt">weights =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="dv">1</span>,<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(year_continuous)))</a>
<a class="sourceLine" id="cb20-18" data-line-number="18"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/save">save</a></span>(paper_paper_cp_results_rodent2, <span class="dt">file =</span> here<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/here/topics/here">here</a></span>(<span class="st">'vignettes'</span>, <span class="st">'christensenetal-comparison-files'</span>, <span class="st">'model-cache'</span>, <span class="st">'paper_paper_2.Rds'</span>))</a>
<a class="sourceLine" id="cb20-19" data-line-number="19"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rm">rm</a></span>(paper_paper_cp_results_rodent2)</a>
<a class="sourceLine" id="cb20-20" data-line-number="20"></a>
<a class="sourceLine" id="cb20-21" data-line-number="21">paper_paper_cp_results_rodent3 =<span class="st"> </span><span class="kw">changepoint_model</span>(ldamodel, x, <span class="dv">3</span>, <span class="dt">weights =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="dv">1</span>,<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(year_continuous)))</a>
<a class="sourceLine" id="cb20-22" data-line-number="22"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/save">save</a></span>(paper_paper_cp_results_rodent3, <span class="dt">file =</span> here<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/here/topics/here">here</a></span>(<span class="st">'vignettes'</span>, <span class="st">'christensenetal-comparison-files'</span>, <span class="st">'model-cache'</span>, <span class="st">'paper_paper_3.Rds'</span>))</a>
<a class="sourceLine" id="cb20-23" data-line-number="23"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rm">rm</a></span>(paper_paper_cp_results_rodent3)</a>
<a class="sourceLine" id="cb20-24" data-line-number="24"></a>
<a class="sourceLine" id="cb20-25" data-line-number="25">paper_paper_cp_results_rodent4 =<span class="st"> </span><span class="kw">changepoint_model</span>(ldamodel, x, <span class="dv">4</span>, <span class="dt">weights =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="dv">1</span>,<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(year_continuous)))</a>
<a class="sourceLine" id="cb20-26" data-line-number="26"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/save">save</a></span>(paper_paper_cp_results_rodent4, <span class="dt">file =</span> here<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/here/topics/here">here</a></span>(<span class="st">'vignettes'</span>, <span class="st">'christensenetal-comparison-files'</span>, <span class="st">'model-cache'</span>, <span class="st">'paper_paper_4.Rds'</span>))</a>
<a class="sourceLine" id="cb20-27" data-line-number="27"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rm">rm</a></span>(paper_paper_cp_results_rodent4)</a>
<a class="sourceLine" id="cb20-28" data-line-number="28"></a>
<a class="sourceLine" id="cb20-29" data-line-number="29">paper_paper_cp_results_rodent5 =<span class="st"> </span><span class="kw">changepoint_model</span>(ldamodel, x, <span class="dv">5</span>, <span class="dt">weights =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="dv">1</span>,<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(year_continuous)))</a>
<a class="sourceLine" id="cb20-30" data-line-number="30"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/save">save</a></span>(paper_paper_cp_results_rodent5, <span class="dt">file =</span> here<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/here/topics/here">here</a></span>(<span class="st">'vignettes'</span>, <span class="st">'christensenetal-comparison-files'</span>, <span class="st">'model-cache'</span>, <span class="st">'paper_paper_5.Rds'</span>))</a>
<a class="sourceLine" id="cb20-31" data-line-number="31"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rm">rm</a></span>(paper_paper_cp_results_rodent5)</a>
<a class="sourceLine" id="cb20-32" data-line-number="32"></a>
<a class="sourceLine" id="cb20-33" data-line-number="33">paper_paper_cp_results_rodent6 =<span class="st"> </span><span class="kw">changepoint_model</span>(ldamodel, x, <span class="dv">6</span>, <span class="dt">weights =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="dv">1</span>,<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(year_continuous)))</a>
<a class="sourceLine" id="cb20-34" data-line-number="34"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/save">save</a></span>(paper_paper_cp_results_rodent6, <span class="dt">file =</span> here<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/here/topics/here">here</a></span>(<span class="st">'vignettes'</span>, <span class="st">'christensenetal-comparison-files'</span>, <span class="st">'model-cache'</span>, <span class="st">'paper_paper_6.Rds'</span>))</a>
<a class="sourceLine" id="cb20-35" data-line-number="35"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rm">rm</a></span>(paper_paper_cp_results_rodent6)</a></code></pre></div>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1">#### Changepoint model selection ####</a>
<a class="sourceLine" id="cb21-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/load">load</a></span>(here<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/here/topics/here">here</a></span>(<span class="st">'vignettes'</span>, <span class="st">'christensenetal-comparison-files'</span>, <span class="st">'model-cache'</span>, <span class="st">'paper_paper_1.Rds'</span>))</a>
<a class="sourceLine" id="cb21-3" data-line-number="3"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/load">load</a></span>(here<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/here/topics/here">here</a></span>(<span class="st">'vignettes'</span>, <span class="st">'christensenetal-comparison-files'</span>, <span class="st">'model-cache'</span>, <span class="st">'paper_paper_2.Rds'</span>))</a>
<a class="sourceLine" id="cb21-4" data-line-number="4"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/load">load</a></span>(here<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/here/topics/here">here</a></span>(<span class="st">'vignettes'</span>, <span class="st">'christensenetal-comparison-files'</span>, <span class="st">'model-cache'</span>, <span class="st">'paper_paper_3.Rds'</span>))</a>
<a class="sourceLine" id="cb21-5" data-line-number="5"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/load">load</a></span>(here<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/here/topics/here">here</a></span>(<span class="st">'vignettes'</span>, <span class="st">'christensenetal-comparison-files'</span>, <span class="st">'model-cache'</span>, <span class="st">'paper_paper_4.Rds'</span>))</a>
<a class="sourceLine" id="cb21-6" data-line-number="6"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/load">load</a></span>(here<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/here/topics/here">here</a></span>(<span class="st">'vignettes'</span>, <span class="st">'christensenetal-comparison-files'</span>, <span class="st">'model-cache'</span>, <span class="st">'paper_paper_5.Rds'</span>))</a>
<a class="sourceLine" id="cb21-7" data-line-number="7"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/load">load</a></span>(here<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/here/topics/here">here</a></span>(<span class="st">'vignettes'</span>, <span class="st">'christensenetal-comparison-files'</span>, <span class="st">'model-cache'</span>, <span class="st">'paper_paper_6.Rds'</span>))</a></code></pre></div>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1">ntopics =<span class="st"> </span>ldamodel<span class="op">@</span>k</a>
<a class="sourceLine" id="cb22-2" data-line-number="2"></a>
<a class="sourceLine" id="cb22-3" data-line-number="3"><span class="co"># change point model selection</span></a>
<a class="sourceLine" id="cb22-4" data-line-number="4"><span class="co"># mean deviance ( -2 * log likelihood) + 2*(#parameters)</span></a>
<a class="sourceLine" id="cb22-5" data-line-number="5"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/mean">mean</a></span>(paper_paper_cp_results_rodent<span class="op">$</span>saved_lls <span class="op">*</span><span class="st"> </span><span class="dv">-2</span>) <span class="op">+</span><span class="st"> </span><span class="dv">2</span><span class="op">*</span>(<span class="dv">3</span><span class="op">*</span>(ntopics<span class="dv">-1</span>)<span class="op">*</span>(<span class="dv">1</span><span class="op">+</span><span class="dv">1</span>)<span class="op">+</span>(<span class="dv">1</span>))</a>
<a class="sourceLine" id="cb22-6" data-line-number="6"><span class="co">#&gt; [1] 898.5209</span></a>
<a class="sourceLine" id="cb22-7" data-line-number="7"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/mean">mean</a></span>(paper_paper_cp_results_rodent2<span class="op">$</span>saved_lls <span class="op">*</span><span class="st"> </span><span class="dv">-2</span>)<span class="op">+</span><span class="st"> </span><span class="dv">2</span><span class="op">*</span>(<span class="dv">3</span><span class="op">*</span>(ntopics<span class="dv">-1</span>)<span class="op">*</span>(<span class="dv">2</span><span class="op">+</span><span class="dv">1</span>)<span class="op">+</span>(<span class="dv">2</span>))</a>
<a class="sourceLine" id="cb22-8" data-line-number="8"><span class="co">#&gt; [1] 834.8776</span></a>
<a class="sourceLine" id="cb22-9" data-line-number="9"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/mean">mean</a></span>(paper_paper_cp_results_rodent3<span class="op">$</span>saved_lls <span class="op">*</span><span class="st"> </span><span class="dv">-2</span>)<span class="op">+</span><span class="st"> </span><span class="dv">2</span><span class="op">*</span>(<span class="dv">3</span><span class="op">*</span>(ntopics<span class="dv">-1</span>)<span class="op">*</span>(<span class="dv">3</span><span class="op">+</span><span class="dv">1</span>)<span class="op">+</span>(<span class="dv">3</span>))</a>
<a class="sourceLine" id="cb22-10" data-line-number="10"><span class="co">#&gt; [1] 818.1249</span></a>
<a class="sourceLine" id="cb22-11" data-line-number="11"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/mean">mean</a></span>(paper_paper_cp_results_rodent4<span class="op">$</span>saved_lls <span class="op">*</span><span class="st"> </span><span class="dv">-2</span>)<span class="op">+</span><span class="st"> </span><span class="dv">2</span><span class="op">*</span>(<span class="dv">3</span><span class="op">*</span>(ntopics<span class="dv">-1</span>)<span class="op">*</span>(<span class="dv">4</span><span class="op">+</span><span class="dv">1</span>)<span class="op">+</span>(<span class="dv">4</span>))</a>
<a class="sourceLine" id="cb22-12" data-line-number="12"><span class="co">#&gt; [1] 813.6164</span></a>
<a class="sourceLine" id="cb22-13" data-line-number="13"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/mean">mean</a></span>(paper_paper_cp_results_rodent5<span class="op">$</span>saved_lls <span class="op">*</span><span class="st"> </span><span class="dv">-2</span>)<span class="op">+</span><span class="st"> </span><span class="dv">2</span><span class="op">*</span>(<span class="dv">3</span><span class="op">*</span>(ntopics<span class="dv">-1</span>)<span class="op">*</span>(<span class="dv">5</span><span class="op">+</span><span class="dv">1</span>)<span class="op">+</span>(<span class="dv">5</span>))</a>
<a class="sourceLine" id="cb22-14" data-line-number="14"><span class="co">#&gt; [1] 817.8308</span></a>
<a class="sourceLine" id="cb22-15" data-line-number="15"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/mean">mean</a></span>(paper_paper_cp_results_rodent6<span class="op">$</span>saved_lls <span class="op">*</span><span class="st"> </span><span class="dv">-2</span>)<span class="op">+</span><span class="st"> </span><span class="dv">2</span><span class="op">*</span>(<span class="dv">3</span><span class="op">*</span>(ntopics<span class="dv">-1</span>)<span class="op">*</span>(<span class="dv">6</span><span class="op">+</span><span class="dv">1</span>)<span class="op">+</span>(<span class="dv">6</span>))</a>
<a class="sourceLine" id="cb22-16" data-line-number="16"><span class="co">#&gt; [1] 826.4913</span></a>
<a class="sourceLine" id="cb22-17" data-line-number="17"></a>
<a class="sourceLine" id="cb22-18" data-line-number="18"><span class="co"># The lowest deviance is for 4 changepoints.</span></a>
<a class="sourceLine" id="cb22-19" data-line-number="19"></a>
<a class="sourceLine" id="cb22-20" data-line-number="20">paper_paper_cpt_selected =<span class="st"> </span>paper_paper_cp_results_rodent4</a>
<a class="sourceLine" id="cb22-21" data-line-number="21"></a>
<a class="sourceLine" id="cb22-22" data-line-number="22">df_<span class="dv">4</span> =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/as.data.frame">as.data.frame</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/t">t</a></span>(paper_paper_cpt_selected<span class="op">$</span>saved[,<span class="dv">1</span>,])) <span class="op">%&gt;%</span><span class="st">  </span>reshape<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/reshape/topics/melt-24">melt</a></span>()</a>
<a class="sourceLine" id="cb22-23" data-line-number="23"><span class="co">#&gt; Using  as id variables</span></a>
<a class="sourceLine" id="cb22-24" data-line-number="24">df_<span class="dv">4</span><span class="op">$</span>value =<span class="st"> </span>year_continuous[df_<span class="dv">4</span><span class="op">$</span>value]</a>
<a class="sourceLine" id="cb22-25" data-line-number="25"></a>
<a class="sourceLine" id="cb22-26" data-line-number="26"></a>
<a class="sourceLine" id="cb22-27" data-line-number="27">paper_paper_cpt_dates &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/vector">vector</a></span>(<span class="dt">length =</span> <span class="dv">4</span>)</a>
<a class="sourceLine" id="cb22-28" data-line-number="28">paper_paper_cpt_dates[<span class="dv">1</span>] &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/mean">mean</a></span>(df_<span class="dv">4</span>[df_<span class="dv">4</span><span class="op">$</span>variable<span class="op">==</span><span class="st">'V1'</span>,<span class="st">'value'</span>]) <span class="op">%&gt;%</span><span class="st"> </span>lubridate<span class="op">::</span><span class="kw"><a href="http://lubridate.tidyverse.org/reference/date_decimal.html">date_decimal</a></span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/format">format</a></span>(<span class="st">'%Y-%m-%d'</span>)</a>
<a class="sourceLine" id="cb22-29" data-line-number="29">paper_paper_cpt_dates[<span class="dv">2</span>] &lt;-<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/mean">mean</a></span>(df_<span class="dv">4</span>[df_<span class="dv">4</span><span class="op">$</span>variable<span class="op">==</span><span class="st">'V2'</span>,<span class="st">'value'</span>]) <span class="op">%&gt;%</span><span class="st"> </span>lubridate<span class="op">::</span><span class="kw"><a href="http://lubridate.tidyverse.org/reference/date_decimal.html">date_decimal</a></span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/format">format</a></span>(<span class="st">'%Y-%m-%d'</span>)</a>
<a class="sourceLine" id="cb22-30" data-line-number="30">paper_paper_cpt_dates[<span class="dv">3</span>] &lt;-<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/mean">mean</a></span>(df_<span class="dv">4</span>[df_<span class="dv">4</span><span class="op">$</span>variable<span class="op">==</span><span class="st">'V3'</span>,<span class="st">'value'</span>]) <span class="op">%&gt;%</span><span class="st"> </span>lubridate<span class="op">::</span><span class="kw"><a href="http://lubridate.tidyverse.org/reference/date_decimal.html">date_decimal</a></span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/format">format</a></span>(<span class="st">'%Y-%m-%d'</span>)</a>
<a class="sourceLine" id="cb22-31" data-line-number="31">paper_paper_cpt_dates[<span class="dv">4</span>] &lt;-<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/mean">mean</a></span>(df_<span class="dv">4</span>[df_<span class="dv">4</span><span class="op">$</span>variable<span class="op">==</span><span class="st">'V4'</span>,<span class="st">'value'</span>]) <span class="op">%&gt;%</span><span class="st"> </span>lubridate<span class="op">::</span><span class="kw"><a href="http://lubridate.tidyverse.org/reference/date_decimal.html">date_decimal</a></span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/format">format</a></span>(<span class="st">'%Y-%m-%d'</span>)</a>
<a class="sourceLine" id="cb22-32" data-line-number="32"></a>
<a class="sourceLine" id="cb22-33" data-line-number="33">paper_paper_cpt_dates</a>
<a class="sourceLine" id="cb22-34" data-line-number="34"><span class="co">#&gt; [1] "1984-04-14" "1992-11-24" "1999-05-29" "2010-01-01"</span></a></code></pre></div>
</div>
</div>
<div id="running-ldats-changepoint-models" class="section level3">
<h3 class="hasAnchor">
<a href="#running-ldats-changepoint-models" class="anchor"></a>Running LDATS changepoint models</h3>
<div id="ldats-lda-and-ldats-changepoint" class="section level4">
<h4 class="hasAnchor">
<a href="#ldats-lda-and-ldats-changepoint" class="anchor"></a>LDATS LDA and LDATS changepoint</h4>
</div>
<div id="run-the-ts-models" class="section level4">
<h4 class="hasAnchor">
<a href="#run-the-ts-models" class="anchor"></a>Run the TS models</h4>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" data-line-number="1">#### Run LDATS changepoint ####</a>
<a class="sourceLine" id="cb23-2" data-line-number="2"></a>
<a class="sourceLine" id="cb23-3" data-line-number="3">ldats_ldats_cpt &lt;-<span class="st"> </span><span class="kw"><a href="../reference/TS_on_LDA.html">TS_on_LDA</a></span>(<span class="dt">LDA_models =</span> ldats_lda_selected,</a>
<a class="sourceLine" id="cb23-4" data-line-number="4">                             <span class="dt">document_covariate_table =</span> rodents<span class="op">$</span>document_covariate_table,</a>
<a class="sourceLine" id="cb23-5" data-line-number="5">                             <span class="dt">formulas =</span> <span class="op">~</span><span class="st"> </span>sin_year <span class="op">+</span><span class="st"> </span>cos_year,</a>
<a class="sourceLine" id="cb23-6" data-line-number="6">                             <span class="dt">nchangepoints =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">6</span>,</a>
<a class="sourceLine" id="cb23-7" data-line-number="7">                             <span class="dt">timename =</span> <span class="st">'newmoon'</span>,</a>
<a class="sourceLine" id="cb23-8" data-line-number="8">                             <span class="dt">weights =</span> <span class="ot">NULL</span>)</a>
<a class="sourceLine" id="cb23-9" data-line-number="9"></a>
<a class="sourceLine" id="cb23-10" data-line-number="10"></a>
<a class="sourceLine" id="cb23-11" data-line-number="11"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/save">save</a></span>(ldats_ldats_cpt, <span class="dt">file =</span> here<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/here/topics/here">here</a></span>(<span class="st">'vignettes'</span>, <span class="st">'christensenetal-comparison-files'</span>, <span class="st">'model-cache'</span>, <span class="st">'ldats_ldats.Rds'</span>))</a>
<a class="sourceLine" id="cb23-12" data-line-number="12"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rm">rm</a></span>(ldats_ldats_cpt)</a>
<a class="sourceLine" id="cb23-13" data-line-number="13"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rm">rm</a></span>(ldats_lda_selected)</a></code></pre></div>
</div>
</div>
<div id="select-model" class="section level3">
<h3 class="hasAnchor">
<a href="#select-model" class="anchor"></a>Select model</h3>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" data-line-number="1"></a>
<a class="sourceLine" id="cb24-2" data-line-number="2">ldats_ldats_cpt_selected &lt;-<span class="st"> </span><span class="kw"><a href="../reference/select_TS.html">select_TS</a></span>(ldats_ldats_cpt)</a>
<a class="sourceLine" id="cb24-3" data-line-number="3"></a>
<a class="sourceLine" id="cb24-4" data-line-number="4">ldats_ldats_cpt_selected<span class="op">$</span>nchangepoints</a>
<a class="sourceLine" id="cb24-5" data-line-number="5"><span class="co">#&gt; [1] 4</span></a></code></pre></div>
</div>
<div id="get-dates-associated-with-changepoints" class="section level3">
<h3 class="hasAnchor">
<a href="#get-dates-associated-with-changepoints" class="anchor"></a>Get dates associated with changepoints</h3>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" data-line-number="1">ldats_ldats_cpt_dates &lt;-<span class="st"> </span>ldats_ldats_cpt_selected<span class="op">$</span>rho_summary<span class="op">$</span>Mean</a>
<a class="sourceLine" id="cb25-2" data-line-number="2">ldats_ldats_cpt_dates &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Round">round</a></span>(ldats_ldats_cpt_dates)</a>
<a class="sourceLine" id="cb25-3" data-line-number="3"></a>
<a class="sourceLine" id="cb25-4" data-line-number="4">ldats_ldats_cpt_dates &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/as.data.frame">as.data.frame</a></span>(ldats_ldats_cpt_dates)</a>
<a class="sourceLine" id="cb25-5" data-line-number="5"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">colnames</a></span>(ldats_ldats_cpt_dates) &lt;-<span class="st"> 'newmoon'</span></a>
<a class="sourceLine" id="cb25-6" data-line-number="6">ldats_ldats_cpt_dates &lt;-<span class="st"> </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/join.html">left_join</a></span>(ldats_ldats_cpt_dates, rodents<span class="op">$</span>document_covariate_table, <span class="dt">by =</span> <span class="st">'newmoon'</span>)</a>
<a class="sourceLine" id="cb25-7" data-line-number="7">ldats_ldats_cpt_dates &lt;-<span class="st"> </span>ldats_ldats_cpt_dates<span class="op">$</span>censusdate</a></code></pre></div>
</div>
<div id="paper-lda-and-ldats-changepoint" class="section level3">
<h3 class="hasAnchor">
<a href="#paper-lda-and-ldats-changepoint" class="anchor"></a>Paper LDA and LDATS changepoint</h3>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" data-line-number="1"></a>
<a class="sourceLine" id="cb26-2" data-line-number="2">#### Load LDA ####</a>
<a class="sourceLine" id="cb26-3" data-line-number="3"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/load">load</a></span>(here<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/here/topics/here">here</a></span>(<span class="st">'vignettes'</span>, <span class="st">'christensenetal-comparison-files'</span>, <span class="st">'model-cache'</span>, <span class="st">'paper_ldamodel.Rds'</span>))</a></code></pre></div>
<div id="run-the-ts-models-1" class="section level4">
<h4 class="hasAnchor">
<a href="#run-the-ts-models-1" class="anchor"></a>Run the TS models</h4>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" data-line-number="1">#### Run LDATS changepoint ####</a>
<a class="sourceLine" id="cb27-2" data-line-number="2"></a>
<a class="sourceLine" id="cb27-3" data-line-number="3">paper_ldats_cpt &lt;-<span class="st"> </span><span class="kw"><a href="../reference/TS_on_LDA.html">TS_on_LDA</a></span>(<span class="dt">LDA_models =</span> ldamodel,</a>
<a class="sourceLine" id="cb27-4" data-line-number="4">                             <span class="dt">document_covariate_table =</span> rodents<span class="op">$</span>document_covariate_table,</a>
<a class="sourceLine" id="cb27-5" data-line-number="5">                             <span class="dt">formulas =</span> <span class="op">~</span><span class="st"> </span>sin_year <span class="op">+</span><span class="st"> </span>cos_year,</a>
<a class="sourceLine" id="cb27-6" data-line-number="6">                             <span class="dt">nchangepoints =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">6</span>,</a>
<a class="sourceLine" id="cb27-7" data-line-number="7">                             <span class="dt">timename =</span> <span class="st">'newmoon'</span>,</a>
<a class="sourceLine" id="cb27-8" data-line-number="8">                             <span class="dt">weights =</span> <span class="ot">NULL</span>)</a>
<a class="sourceLine" id="cb27-9" data-line-number="9"></a>
<a class="sourceLine" id="cb27-10" data-line-number="10"></a>
<a class="sourceLine" id="cb27-11" data-line-number="11"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/save">save</a></span>(paper_ldats_cpt, <span class="dt">file =</span> here<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/here/topics/here">here</a></span>(<span class="st">'vignettes'</span>, <span class="st">'christensenetal-comparison-files'</span>, <span class="st">'model-cache'</span>, <span class="st">'paper_ldats.Rds'</span>))</a>
<a class="sourceLine" id="cb27-12" data-line-number="12"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rm">rm</a></span>(paper_ldats_cpt)</a>
<a class="sourceLine" id="cb27-13" data-line-number="13"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rm">rm</a></span>(ldamodel)</a></code></pre></div>
</div>
</div>
<div id="select-model-1" class="section level3">
<h3 class="hasAnchor">
<a href="#select-model-1" class="anchor"></a>Select model</h3>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb28-1" data-line-number="1"></a>
<a class="sourceLine" id="cb28-2" data-line-number="2">paper_ldats_cpt_selected &lt;-<span class="st"> </span><span class="kw"><a href="../reference/select_TS.html">select_TS</a></span>(paper_ldats_cpt)</a>
<a class="sourceLine" id="cb28-3" data-line-number="3"></a>
<a class="sourceLine" id="cb28-4" data-line-number="4">paper_ldats_cpt_selected<span class="op">$</span>nchangepoints</a>
<a class="sourceLine" id="cb28-5" data-line-number="5"><span class="co">#&gt; [1] 4</span></a></code></pre></div>
<div id="get-dates" class="section level4">
<h4 class="hasAnchor">
<a href="#get-dates" class="anchor"></a>Get dates</h4>
<p>Unlike the paper changepoint model, LDATS can recognize that sampling periods may not be equidistant, and can place changepoint estimates at new moons if they fall between nonconsecutive sampling periods. We can estimate the dates corresponding to those new moons, extrapolating from the census dates for adjacent census periods.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" data-line-number="1">paper_ldats_cpt_dates &lt;-<span class="st"> </span>paper_ldats_cpt_selected<span class="op">$</span>rho_summary<span class="op">$</span>Mean</a>
<a class="sourceLine" id="cb29-2" data-line-number="2">paper_ldats_cpt_dates &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Round">round</a></span>(paper_ldats_cpt_dates)</a>
<a class="sourceLine" id="cb29-3" data-line-number="3"></a>
<a class="sourceLine" id="cb29-4" data-line-number="4">paper_ldats_cpt_dates &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/as.data.frame">as.data.frame</a></span>(paper_ldats_cpt_dates)</a>
<a class="sourceLine" id="cb29-5" data-line-number="5"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/colnames">colnames</a></span>(paper_ldats_cpt_dates) &lt;-<span class="st"> 'newmoon'</span></a>
<a class="sourceLine" id="cb29-6" data-line-number="6">paper_ldats_cpt_dates &lt;-<span class="st"> </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/join.html">left_join</a></span>(paper_ldats_cpt_dates, rodents<span class="op">$</span>document_covariate_table, <span class="dt">by =</span> <span class="st">'newmoon'</span>)</a>
<a class="sourceLine" id="cb29-7" data-line-number="7"></a>
<a class="sourceLine" id="cb29-8" data-line-number="8">halfinterval =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/integer">as.integer</a></span>((<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/as.Date">as.Date</a></span>(rodents<span class="op">$</span>document_covariate_table<span class="op">$</span>censusdate[ <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/which">which</a></span>(rodents<span class="op">$</span>document_covariate_table<span class="op">$</span>newmoon <span class="op">==</span><span class="st"> </span>paper_ldats_cpt_dates<span class="op">$</span>newmoon[<span class="dv">1</span>] <span class="op">+</span><span class="st"> </span><span class="dv">1</span>)]) <span class="op">-</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/as.Date">as.Date</a></span>(rodents<span class="op">$</span>document_covariate_table<span class="op">$</span>censusdate[ <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/which">which</a></span>(rodents<span class="op">$</span>document_covariate_table<span class="op">$</span>newmoon <span class="op">==</span><span class="st"> </span>paper_ldats_cpt_dates<span class="op">$</span>newmoon[<span class="dv">1</span>] <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)]))<span class="op">/</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb29-9" data-line-number="9"></a>
<a class="sourceLine" id="cb29-10" data-line-number="10">newdate &lt;-<span class="st"> </span>lubridate<span class="op">::</span><span class="kw"><a href="http://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span>(rodents<span class="op">$</span>document_covariate_table<span class="op">$</span>censusdate[ <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/which">which</a></span>(rodents<span class="op">$</span>document_covariate_table<span class="op">$</span>newmoon <span class="op">==</span><span class="st"> </span>paper_ldats_cpt_dates<span class="op">$</span>newmoon[<span class="dv">1</span>] <span class="dv">-1</span> )]) <span class="op">+</span><span class="st"> </span>lubridate<span class="op">::</span><span class="kw"><a href="http://lubridate.tidyverse.org/reference/period.html">days</a></span>(halfinterval)</a>
<a class="sourceLine" id="cb29-11" data-line-number="11"></a>
<a class="sourceLine" id="cb29-12" data-line-number="12">paper_ldats_cpt_dates<span class="op">$</span>censusdate[<span class="dv">1</span>] &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/character">as.character</a></span>(newdate)</a>
<a class="sourceLine" id="cb29-13" data-line-number="13"></a>
<a class="sourceLine" id="cb29-14" data-line-number="14"></a>
<a class="sourceLine" id="cb29-15" data-line-number="15"></a>
<a class="sourceLine" id="cb29-16" data-line-number="16">halfinterval =<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/integer">as.integer</a></span>((<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/as.Date">as.Date</a></span>(rodents<span class="op">$</span>document_covariate_table<span class="op">$</span>censusdate[ <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/which">which</a></span>(rodents<span class="op">$</span>document_covariate_table<span class="op">$</span>newmoon <span class="op">==</span><span class="st"> </span>paper_ldats_cpt_dates<span class="op">$</span>newmoon[<span class="dv">3</span>] <span class="op">+</span><span class="st"> </span><span class="dv">2</span>)]) <span class="op">-</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/as.Date">as.Date</a></span>(rodents<span class="op">$</span>document_covariate_table<span class="op">$</span>censusdate[ <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/which">which</a></span>(rodents<span class="op">$</span>document_covariate_table<span class="op">$</span>newmoon <span class="op">==</span><span class="st"> </span>paper_ldats_cpt_dates<span class="op">$</span>newmoon[<span class="dv">3</span>] <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)]))<span class="op">/</span><span class="dv">3</span>)</a>
<a class="sourceLine" id="cb29-17" data-line-number="17"></a>
<a class="sourceLine" id="cb29-18" data-line-number="18">newdate &lt;-<span class="st"> </span>lubridate<span class="op">::</span><span class="kw"><a href="http://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span>(rodents<span class="op">$</span>document_covariate_table<span class="op">$</span>censusdate[ <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/which">which</a></span>(rodents<span class="op">$</span>document_covariate_table<span class="op">$</span>newmoon <span class="op">==</span><span class="st"> </span>paper_ldats_cpt_dates<span class="op">$</span>newmoon[<span class="dv">3</span>] <span class="dv">-2</span> )]) <span class="op">+</span><span class="st"> </span>lubridate<span class="op">::</span><span class="kw"><a href="http://lubridate.tidyverse.org/reference/period.html">days</a></span>(halfinterval)</a>
<a class="sourceLine" id="cb29-19" data-line-number="19"></a>
<a class="sourceLine" id="cb29-20" data-line-number="20">paper_ldats_cpt_dates<span class="op">$</span>censusdate[<span class="dv">3</span>] &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/character">as.character</a></span>(newdate)</a>
<a class="sourceLine" id="cb29-21" data-line-number="21"></a>
<a class="sourceLine" id="cb29-22" data-line-number="22">paper_ldats_cpt_dates &lt;-<span class="st"> </span>paper_ldats_cpt_dates<span class="op">$</span>censusdate</a></code></pre></div>
<p>All of the models find four changepoints.</p>
</div>
</div>
<div id="plot-changepoint-models" class="section level3">
<h3 class="hasAnchor">
<a href="#plot-changepoint-models" class="anchor"></a>Plot changepoint models</h3>
<div id="paper-lda-and-ldats-changepoint-1" class="section level4">
<h4 class="hasAnchor">
<a href="#paper-lda-and-ldats-changepoint-1" class="anchor"></a>Paper LDA and LDATS changepoint</h4>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb30-1" data-line-number="1"></a>
<a class="sourceLine" id="cb30-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(paper_ldats_cpt_selected)</a></code></pre></div>
<p><img src="paper-comparison_files/figure-html/plot%20paper%20LDA%20and%20LDATS%20cpts-1.png" width="672"></p>
</div>
<div id="ldats-lda-and-ldats-changepoint-1" class="section level4">
<h4 class="hasAnchor">
<a href="#ldats-lda-and-ldats-changepoint-1" class="anchor"></a>LDATS LDA and LDATS changepoint</h4>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb31-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(ldats_ldats_cpt_selected)</a></code></pre></div>
<p><img src="paper-comparison_files/figure-html/plot%20ldats%20LDA%20and%20LDATS%20cpt-1.png" width="672"></p>
</div>
<div id="paper-lda-and-paper-changepoint-1" class="section level4">
<h4 class="hasAnchor">
<a href="#paper-lda-and-paper-changepoint-1" class="anchor"></a>Paper LDA and paper changepoint</h4>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb32-1" data-line-number="1"></a>
<a class="sourceLine" id="cb32-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/source">source</a></span>(here<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/here/topics/here">here</a></span>(<span class="st">'vignettes'</span>, <span class="st">'christensenetal-comparison-files'</span>, <span class="st">'christensenetal-2018-files'</span>, <span class="st">'LDA_figure_scripts.R'</span>))</a>
<a class="sourceLine" id="cb32-3" data-line-number="3"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb32-4" data-line-number="4"><span class="co">#&gt; Attaching package: 'gridExtra'</span></a>
<a class="sourceLine" id="cb32-5" data-line-number="5"><span class="co">#&gt; The following object is masked from 'package:dplyr':</span></a>
<a class="sourceLine" id="cb32-6" data-line-number="6"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb32-7" data-line-number="7"><span class="co">#&gt;     combine</span></a>
<a class="sourceLine" id="cb32-8" data-line-number="8"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/source">source</a></span>(here<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/here/topics/here">here</a></span>(<span class="st">'vignettes'</span>, <span class="st">'christensenetal-comparison-files'</span>, <span class="st">'christensenetal-2018-files'</span>, <span class="st">'changepointmodel.r'</span>))</a>
<a class="sourceLine" id="cb32-9" data-line-number="9"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb32-10" data-line-number="10"><span class="co">#&gt; Attaching package: 'lubridate'</span></a>
<a class="sourceLine" id="cb32-11" data-line-number="11"><span class="co">#&gt; The following object is masked from 'package:base':</span></a>
<a class="sourceLine" id="cb32-12" data-line-number="12"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb32-13" data-line-number="13"><span class="co">#&gt;     date</span></a>
<a class="sourceLine" id="cb32-14" data-line-number="14"><span class="co">#&gt; Loading required package: viridisLite</span></a>
<a class="sourceLine" id="cb32-15" data-line-number="15">paper_cpts =<span class="st"> </span><span class="kw">find_changepoint_location</span>(paper_paper_cpt_selected)</a>
<a class="sourceLine" id="cb32-16" data-line-number="16">paper_cpt_plot =<span class="st"> </span><span class="kw">get_ll_non_memoized_plot</span>(ldamodel,x,paper_cpts,<span class="dt">make_plot=</span>T,<span class="dt">weights=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="dv">1</span>,<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(year_continuous)))</a>
<a class="sourceLine" id="cb32-17" data-line-number="17"><span class="kw">annual_hist</span>(paper_paper_cpt_selected, year_continuous)</a></code></pre></div>
<p><img src="paper-comparison_files/figure-html/plot%20paper%20LDA%20and%20paper%20cpt-1.png" width="672"></p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb33-1" data-line-number="1">paper_cpt_plot</a></code></pre></div>
<p><img src="paper-comparison_files/figure-html/plot%20paper%20LDA%20and%20paper%20cpt-2.png" width="672"></p>
</div>
<div id="ldats-lda-and-paper-changepoint-1" class="section level4">
<h4 class="hasAnchor">
<a href="#ldats-lda-and-paper-changepoint-1" class="anchor"></a>LDATS LDA and paper changepoint</h4>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb34-1" data-line-number="1">ntopics =<span class="st"> </span><span class="dv">6</span></a>
<a class="sourceLine" id="cb34-2" data-line-number="2">ldats_cpts =<span class="st"> </span><span class="kw">find_changepoint_location</span>(ldats_paper_cpt_selected)</a>
<a class="sourceLine" id="cb34-3" data-line-number="3">ldats_cpt_plot =<span class="st"> </span><span class="kw">get_ll_non_memoized_plot</span>(ldats_lda_selected[[<span class="dv">1</span>]],x,ldats_cpts,<span class="dt">make_plot=</span>T,<span class="dt">weights=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rep">rep</a></span>(<span class="dv">1</span>,<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(year_continuous)))</a>
<a class="sourceLine" id="cb34-4" data-line-number="4"><span class="kw">annual_hist</span>(ldats_paper_cpt_selected, year_continuous)</a></code></pre></div>
<p><img src="paper-comparison_files/figure-html/plot%20LDATS%20lda%20and%20paper%20cpt-1.png" width="672"></p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb35-1" data-line-number="1">ldats_cpt_plot</a></code></pre></div>
<p><img src="paper-comparison_files/figure-html/plot%20LDATS%20lda%20and%20paper%20cpt-2.png" width="672"></p>
<p>The results of the changepoint model appear extremely robust to both choice of LDA model and choice of changepoint model.</p>
</div>
</div>
<div id="report-changepoint-dates" class="section level3">
<h3 class="hasAnchor">
<a href="#report-changepoint-dates" class="anchor"></a>Report changepoint dates</h3>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb36-1" data-line-number="1">cpt_dates</a>
<a class="sourceLine" id="cb36-2" data-line-number="2"><span class="co">#&gt;   paperLDA_papercpt ldatsLDA_papercpt ldatsLDA_ldatscpt paperLDA_ldatscpt</span></a>
<a class="sourceLine" id="cb36-3" data-line-number="3"><span class="co">#&gt; 1        1984-04-14        1984-01-10        1984-02-04        1984-05-03</span></a>
<a class="sourceLine" id="cb36-4" data-line-number="4"><span class="co">#&gt; 2        1992-11-24        1991-06-03        1991-06-13        1993-04-23</span></a>
<a class="sourceLine" id="cb36-5" data-line-number="5"><span class="co">#&gt; 3        1999-05-29        1999-01-03        1999-01-16        1999-06-14</span></a>
<a class="sourceLine" id="cb36-6" data-line-number="6"><span class="co">#&gt; 4        2010-01-01        2009-11-07        2009-11-14        2010-01-16</span></a></code></pre></div>
<p>The choice of LDA has more influence on the changepoint locations than the choice of changepoint model - probably because the LDATS LDA has 6 topics, and the paper LDA has 4. However, all of the models agree to within 6 months in most cases, and a year for the broader early 1990s changepoint.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#summary">Summary</a></li>
      <li><a href="#ldats-installation">LDATS Installation</a></li>
      <li><a href="#christensen-2018-analysis-files">Christensen 2018 analysis files</a></li>
      <li><a href="#data">Data</a></li>
      <li><a href="#stage-1-lda">Stage 1: LDA</a></li>
      <li><a href="#changepoint-models">Changepoint models</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Juniper L. Simonis, Erica M. Christensen, David J. Harris, Renata M. Diaz, Hao Ye, Ethan P. White, S.K. Morgan Ernest.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
